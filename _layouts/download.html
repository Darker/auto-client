---
layout: default
title: Download
download_title: Download
---
<!-- This sucks but I don't know how make jekyll add the stylesheet to head." -->
<link rel="stylesheet" type="text/css" href="{{site.baseurl}}/stylesheets/download.css" media="screen">
<script>
var GetDownloadInfo = function(cb) {
  GITHUB.getURL(SETTINGS.ghapi+"releases/latest", cb);
}
</script>


<h3>{{ page.download_title }}</h3>
<p id="about-download">
  {{ content }}
</p>
<hr />
<h3>Download will start soon...</h3>
<p id="info">Checking status of releases, please wait...</p>

<p id="download_info" style="display: none">
  <span class="filename" style="background-image: url('http://www.stdicon.com/humility/ddd.zip?size=18');"></span> was updated <span class="time"></span> and downloaded <span class="download_count"></span> times.
</p>
<p id="download" style="display: none">
    <span id="countdown">Download will start in <span id="cd">10</span> seconds. <a class="red" id="countdown-cancel" href="javascript:/* cancel download */void(0);">Click to cancel.</a></span>
    <span id="countdown-after" style="display: none">
      If the download didn't start,
      <a href="{{site.gh_repo}}releases/latest" id="dl_link">click here</a>
      to start manually.
    </span>
    <iframe style="width:1px; height: 1px; position:absolute; top:-100px; left: -100px" id="dl_frame"></iframe>
</p>


<script type="text/javascript">
onready(()=>{
    console.log("Getting download info.");
    console.log("JQuery: ", $);
    GetDownloadInfo((release)=>{
        var asset = findFirstZipAsset(release.assets);
        console.log("Retrieved info: ", release);
        distribute_text({
          filename: asset.name,
          time: timeAgo(asset.updated_at),
          download_count: new Number(asset.download_count).toLocaleString("EN-GB")
        });
        console.log("Hiding info div: ");
        $("#info").fadeOut(300, ()=>{
          console.log("Showing download div: ");
          $("#download, #download_info").fadeIn(300,
            ()=>{console.log("Done showing the div.");}
          );
        });

        $("#dl_link").attr("href", asset.browser_download_url+"#dl_manual");
        
        
        var countdown = $("#cd").countdown(10)
          .always(()=>{
            $("#countdown").fadeOut(800,
              ()=>{
                $("#countdown-after").fadeIn(800);
              }
            );
          })
          .done(()=>{
            if(SETTINGS.auto_download) {
              $("#dl_frame").attr("src", asset.browser_download_url);
              if(typeof ga=="function") {
                ga('send', 'event', 'download', 'click', "success", {
                  'transport': 'beacon',
                });
              }
            }
          });
        $("#countdown-cancel").one("click", ()=>{
          // Tell google analytics that download was stopped
          if(typeof ga=="function") {
            ga('send', 'event', 'download', 'click', "cancel", {
               'transport': 'beacon',
            });
          }
          // Stop download
          countdown.stop();
        });
    });
});
</script>
